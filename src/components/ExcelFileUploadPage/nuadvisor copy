
export let setNextCrns = (students, curriculums) => {
  /*
  purpose:  Get next crns for student. 
  result: return array of next crns that are not conlicted with each other. 
  */

  let currentTerm = new Term();

  for (let i = 0; i < students.length(); i++) {
    let student = students[i];
    let curriculum = curriculums[student.major];

    //1)get list of ids of remain curriculumModules of that students.
    let remainModuleIds = [];
    student.curriculumModules.forEach((module, index) => {
      if (!module.isCompleted) {
        remainModuleIds.push(module.id);
      }
    });

    //2)if remain>=LAST_SEMESTER_MAX ,which means Not last semester
    if (remainModuleIds.length() >= LAST_SEMESTER_MAX) {
      //2.1)Select modules
      let moduleId = remainModuleIds[0];
      let selectedModule = curriculum.modules[moduleId];

      if (selectedModule.isAvailableCourseExist) {
        //2.2)Select course
        let selectedCourse = selectedModule.availableCourses[0];

        //2.3)Select class
        let selectedClass = selectedCourse.classes[0];

        //2.4)Check if it is OK
        let isB50 = isB50(selectedClass);
        let isScheduleOK = isScheduleOK(currentTerm, selectedClass);
        let isSEVPOK = isSEVPOK(currentTerm, selectedClass);
        let isCoreqOK = isCoreqOK(currentTerm, selectedClass);
        //let isNotTaken = isNotTaken(student.completedCourse,selectedClass)
        //If all OK
        if (isB50 && isScheduleOK && isSEVPOK && isCoreqOK) {
          //Add to current term
          currentTerm.addClass(moduleId, selectedClass);
        }
      }
    }
  }

  //)if(remain<LAST_SEMESTER_MAX) -> Last semester
  //)if(remain=0) -> No more class.
};

//Validation
let isB50 = selectedClass => {
  let isB50 = true;
  if (selectedClass.section != 'B50') {
    isB50 = false;
  }
  return isB50;
};
let isScheduleOK = (currentTerm, selectedClass) => {
  let isScheduleOK = true;
  let dayOfWeek = selectedClass.dayOfWeek;
  let schedules = currentTerm.timeTable[dayOfWeek];
  for (let i = 0; i < schedules.length(); i++) {
    if (!(selectedClass.startTime >= schedules[i].endTime || selectedClass.endTime <= schedules[i].startTime)) {
      //If conflict
      isScheduleOK = false;
    }
  }
  return isScheduleOK;
};
let isSEVPOK = (currentTerm, selectedClass) => {
  let isSEVPOK = true;
  //If selectedClass is online
  if (selectedClass.campusCode == 'VTL') {
    if (currentTerm.onlineClass >= ONLINE_MAX) {
      isSEVPOK = false;
    }
  }
  return isSEVPOK;
};
let isCoreqOK = (preqcorequisiteTable, currentTerm, selectedClass) => {
  let isCoreqOK = true;
  let coreq = preqcorequisiteTable[selectedClass.combinedCourseNumber].coreq;
  //If coreq exist
  if (coreq !== '') {
    //check coreq also meets requirement.
    let coreqClass = courses[combinedCourseNumber].classes;
    let isB50 = isB50(coreqClass);
    let isScheduleOK = isScheduleOK(currentTerm, coreqClass);
    let isSEVPOK = isSEVPOK(currentTerm, coreqClass);
  }
  return isScheduleOK;
};

let getClasses = (courses, combinedCourseNumber) => {
  return courses[combinedCourseNumber].classes;
};
let getB50Classes = classes => {
  let b50Classes = [];
  classes.forEach(selectedClass => {
    if (selectedClass.section == 'B50') {
      b50Classes.push(selectedClass);
    }
  });
  return b50Classes;
};
